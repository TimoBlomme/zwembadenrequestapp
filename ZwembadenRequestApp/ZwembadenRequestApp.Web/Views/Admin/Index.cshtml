@model IEnumerable<ZwembadenRequestApp.Core.Entities.QuoteRequest>
@{
    ViewBag.Title = "Admin Panel - Offertes Beheer";
}

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-8">
                            <h3 class="panel-title" style="margin: 0;">
                                <i class="fas fa-tachometer-alt fa-lg" style="margin-right: 10px;"></i>
                                @ViewBag.Title
                            </h3>
                        </div>
                        <div class="col-md-4 text-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                                    <i class="fas fa-filter"></i> Filter op Status
                                </button>
                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li>@Html.ActionLink("Alle", "Index", "Admin", new { status = "" }, null)</li>
                                    <li>@Html.ActionLink("New", "Index", "Admin", new { status = "New" }, null)</li>
                                    <li>@Html.ActionLink("In Progress", "Index", "Admin", new { status = "In Progress" }, null)</li>
                                    <li>@Html.ActionLink("Done", "Index", "Admin", new { status = "Done" }, null)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <!-- Statistics Cards -->
                    <div class="row" style="margin-bottom: 30px;">
                        <div class="col-md-3">
                            <div class="stat-card text-center">
                                <div class="stat-number">@Model.Count()</div>
                                <div class="stat-label">Totaal Aanvragen</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card text-center">
                                <div class="stat-number" style="color: #667eea;">@Model.Count(q => q.Status == "New")</div>
                                <div class="stat-label">Nieuwe Aanvragen</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card text-center">
                                <div class="stat-number" style="color: #f5576c;">@Model.Count(q => q.Status == "In Progress")</div>
                                <div class="stat-label">In Behandeling</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card text-center">
                                <div class="stat-number" style="color: #56ab2f;">@Model.Count(q => q.Status == "Done")</div>
                                <div class="stat-label">Afgerond</div>
                            </div>
                        </div>
                    </div>

                    @if (!Model.Any())
                    {
                        <div class="text-center" style="padding: 40px;">
                            <i class="fas fa-inbox fa-4x text-muted" style="margin-bottom: 20px;"></i>
                            <h4 class="text-muted">Geen offerte aanvragen gevonden</h4>
                            <p class="text-muted">Er zijn nog geen offerte aanvragen ingediend door klanten.</p>
                        </div>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-hover table-striped">
                                <thead>
                                    <tr>
                                        <th>Klant</th>
                                        <th>Configuratie</th>
                                        <th>Status</th>
                                        <th>Prijs</th>
                                        <th>Aanvraag Datum</th>
                                        <th>Acties</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var quote in Model)
                                    {
                                        <tr>
                                            <td>
                                                <strong>@quote.CustomerName</strong>
                                                <br />
                                                <small class="text-muted">ID: @quote.CustomerId</small>
                                            </td>
                                            <td>
                                                <div style="max-width: 300px;">
                                                    <strong>@quote.PoolType</strong><br />
                                                    <small class="text-muted">
                                                        @quote.Length m × @quote.Width m × @quote.Depth m<br />
                                                        Spots: @quote.NumberOfLights | Trap: @(quote.HasStairs ? "Ja" : "Nee")
                                                        @if (!string.IsNullOrEmpty(quote.AdditionalNotes))
                                                        {
                                                        <br />@:Opmerkingen: quote.AdditionalNotes;
                                                                                            }
                                                    </small>
                                                </div>
                                            </td>
                                            <td>
                                                @GetStatusBadge(quote.Status)
                                            </td>
                                            <td>
                                                @if (quote.ProposedPrice.HasValue)
                                                {
                                                    <span class="text-success" style="font-weight: 600; font-size: 1.1em;">
                                                        € @quote.ProposedPrice.Value.ToString("N2")
                                                    </span>
                                                    <br />
                                                    <small class="text-muted">@(quote.ResponseDate.ToString())</small>
                                                }
                                                else
                                                {
                                                    <span class="text-muted">Nog geen prijs</span>
                                                }
                                            </td>
                                            <td>
                                                @quote.RequestDate.ToString("dd/MM/yyyy HH:mm")
                                            </td>
                                            <td>
                                                <div class="btn-group-vertical">
                                                    @Html.ActionLink("Bewerken", "Edit", "Admin", new { id = quote.Id }, new { @class = "btn btn-primary btn-sm", style = "margin-bottom: 5px;" })

                                                    <!-- Quick Status Updates -->
                                                    <div class="btn-group">
                                                        <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                                                            Status <span class="caret"></span>
                                                        </button>
                                                        <ul class="dropdown-menu">
                                                            <li>@Html.ActionLink("New", "UpdateStatus", "Admin", new { id = quote.Id, status = "New" }, null)</li>
                                                            <li>@Html.ActionLink("In Progress", "UpdateStatus", "Admin", new { id = quote.Id, status = "In Progress" }, null)</li>
                                                            <li>@Html.ActionLink("Done", "UpdateStatus", "Admin", new { id = quote.Id, status = "Done" }, null)</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    public IHtmlString GetStatusBadge(string status)
    {
        string badgeClass;
        string statusText;

        switch (status)
        {
            case "New":
                badgeClass = "badge-primary";
                statusText = "Nieuw";
                break;
            case "In Progress":
                badgeClass = "badge-warning";
                statusText = "In Behandeling";
                break;
            case "Done":
                badgeClass = "badge-success";
                statusText = "Afgerond";
                break;
            default:
                badgeClass = "badge-secondary";
                statusText = status;
                break;
        }

        return new HtmlString("<span class='badge " + badgeClass + "' style='font-size: 0.9em; padding: 8px 12px;'>" + statusText + "</span>");
    }
}

<style>
    .panel {
        margin-top: 30px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        border: none;
        border-radius: 12px;
    }

    .panel-heading {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        border-radius: 12px 12px 0 0 !important;
        padding: 20px;
    }

    .panel-title {
        font-weight: 600;
        color: white;
        font-size: 1.4em;
        margin: 0;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        border-left: 4px solid #667eea;
    }

    .stat-number {
        font-size: 2.5em;
        font-weight: 700;
        color: #333;
    }

    .stat-label {
        color: #666;
        font-weight: 500;
        margin-top: 5px;
    }

    .table th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: #333;
        border-bottom: 2px solid #667eea;
    }

    .badge-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .badge-warning {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .badge-success {
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 20px;
        font-weight: 500;
    }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
</style>